<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Ability documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Ability</h1>


<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Examples</h2>
<ul class="nowrap">
  <li><a href="../examples/AbilityConfigCard.lua.html">AbilityConfigCard.lua</a></li>
  <li><a href="../examples/AbilityConfigSkill.lua.html">AbilityConfigSkill.lua</a></li>
  <li><a href="../examples/AbilityConfigState.lua.html">AbilityConfigState.lua</a></li>
  <li><strong>AbilityConfigPassive.lua</strong></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/Enum.html">Enum</a></li>
</ul>
<h2>Classes</h2>
<ul class="nowrap">
  <li><a href="../classes/Ability.html">Ability</a></li>
  <li><a href="../classes/Unit.html">Unit</a></li>
  <li><a href="../classes/AbilityConfig.html">AbilityConfig</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/HOWTO.md.html">HOWTO</a></li>
</ul>

</div>

<div id="content">

    <h2>AbilityConfigPassive.lua</h2>
<pre>
<span class="keyword">local</span> AbilityDataTable = <span class="global">require</span> <span class="string">"Core/Common/FrameBattle/Ability/AbilityDataTable"</span>
<span class="keyword">local</span> BattleConst = AbilityDataTable.BattleConst
<span class="keyword">local</span> ResPassiveSkill = AbilityDataTable.ResPassiveSkill
<span class="keyword">local</span> ResPassiveEffect = AbilityDataTable.ResPassiveEffect

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function-name">raiseEffect</span>(self, effectData, triggerUnit)
    <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel
    <span class="keyword">local</span> triggerEffectRate = resEffectLevel.triggerEffectRate
    <span class="keyword">if</span> triggerEffectRate <span class="keyword">and</span> triggerEffectRate &gt; <span class="number">0</span> <span class="keyword">then</span>
        <span class="keyword">if</span> <span class="keyword">not</span> self:<span class="function-name">checkRandomControl</span>(triggerEffectRate, resEffectLevel.level, <span class="keyword">nil</span>, BattleConst.FAKE_PROB_TYPE_PASSIVE, resEffectLevel.id) <span class="keyword">then</span>
            <span class="keyword">return</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="keyword">local</span> effect_cd = resEffectLevel.effect_cd
    <span class="keyword">if</span> effect_cd <span class="keyword">and</span> <span class="keyword">not</span> self:<span class="function-name">checkCooldown</span>(resEffectLevel.id, effect_cd) <span class="keyword">then</span>
        <span class="keyword">return</span>
    <span class="keyword">end</span>
    <span class="keyword">for</span> _, effect <span class="keyword">in</span> <span class="global">ipairs</span>(resEffectLevel.effectInfo) <span class="keyword">do</span>
        <span class="keyword">local</span> effectType = effect.effectType
        <span class="keyword">local</span> effectArgs = effect.effectArgs
        <span class="keyword">if</span> effectType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- ◆类型1-触发攻击事件
</span>            <span class="keyword">local</span> skillId = <span class="global">tonumber</span>(effectArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-填写技能ID
</span>            <span class="keyword">local</span> effectId = <span class="global">tonumber</span>(effectArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-填写技能事件ID
</span>            <span class="keyword">local</span> attackerType = <span class="global">tonumber</span>(effectArgs[<span class="number">3</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数C-释放者和目标类型
</span>            <span class="keyword">local</span> attacker, target
            <span class="keyword">local</span> ownerUnit = self:<span class="function-name">getOwnerUnit</span>()
            <span class="keyword">local</span> sourceUnit = self:<span class="function-name">getSourceUnit</span>()
            <span class="keyword">if</span> attackerType == <span class="number">0</span> <span class="keyword">then</span> <span class="comment">-- 类型0表示“释放者为被动载体，目标为被动触发者”
</span>                attacker, target = ownerUnit, triggerUnit
            <span class="keyword">elseif</span> attackerType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- 类型1表示“释放者为被动施加者，目标为被动载体”
</span>                attacker, target = sourceUnit, ownerUnit
            <span class="keyword">elseif</span> attackerType == <span class="number">2</span> <span class="keyword">then</span> <span class="comment">-- 类型2表示“释放者为被动施加者，目标为被动触发者”
</span>                attacker, target = sourceUnit, triggerUnit
            <span class="keyword">elseif</span> attackerType == <span class="number">3</span> <span class="keyword">then</span> <span class="comment">-- 类型3表示“释放者为被动触发者，目标为被动载体”
</span>                attacker, target = triggerUnit, ownerUnit
            <span class="keyword">elseif</span> attackerType == <span class="number">4</span> <span class="keyword">then</span> <span class="comment">-- 类型4表示“释放者为被动载体，目标为被动施加者”
</span>                attacker, target = ownerUnit, sourceUnit
            <span class="keyword">elseif</span> attackerType == <span class="number">5</span> <span class="keyword">then</span> <span class="comment">-- 类型5表示“释放者为被动触发者，目标为被动施加者”
</span>                attacker, target = triggerUnit, sourceUnit
            <span class="keyword">end</span>
            self:<span class="function-name">triggerSkillEvent</span>(attacker, target, skillId, effectId, resEffectLevel.effectLevel)
        <span class="keyword">elseif</span> effectType == <span class="number">2</span> <span class="keyword">then</span> <span class="comment">-- ◆类型2-添加状态
</span>            <span class="keyword">local</span> targetType = <span class="global">tonumber</span>(effectArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数A-类型0表示给自身添加状态，类型1表示给目标添加状态
</span>            <span class="keyword">local</span> stateId = <span class="global">tonumber</span>(effectArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-状态ID
</span>            <span class="keyword">local</span> stateLevel = <span class="global">tonumber</span>(effectArgs[<span class="number">3</span>]) <span class="comment">-- 参数C-状态等级
</span>            <span class="keyword">local</span> stateDuration = <span class="global">tonumber</span>(effectArgs[<span class="number">4</span>]) <span class="comment">-- 参数D-状态持续时间，填-999表示无限时长
</span>            <span class="keyword">if</span> stateDuration == -<span class="number">999</span> <span class="keyword">then</span>
                stateDuration = <span class="keyword">nil</span>
            <span class="keyword">end</span>
            <span class="keyword">local</span> ownerUnit = self:<span class="function-name">getOwnerUnit</span>()
            <span class="keyword">local</span> targetUnit = targetType == <span class="number">0</span> <span class="keyword">and</span> ownerUnit <span class="keyword">or</span> triggerUnit
            <span class="keyword">if</span> effectData.layer <span class="keyword">then</span>
                self:<span class="function-name">setStateLayer</span>(targetUnit, <span class="string">'state'</span>, stateId, stateLevel, effectData.layer, stateDuration)
            <span class="keyword">else</span>
                <span class="comment">--TODO 触发攻击事件 PASSIVE_TRIGGER_TYPE_ATTACK_RESULT
</span>                self:<span class="function-name">incStateLayer</span>(targetUnit, stateId, stateLevel, <span class="number">1</span>, stateDuration)
                <span class="comment">-- TODO 触发受击事件 PASSIVE_TRIGGER_TYPE_BEING_ATTACKED_RESULT
</span>            <span class="keyword">end</span>

        <span class="keyword">elseif</span> effectType == <span class="number">3</span> <span class="keyword">then</span> <span class="comment">-- ◆类型3-触发卡牌技能，相比类型1，此类型存在动作表现
</span>            <span class="keyword">local</span> cardId = <span class="global">tonumber</span>(effectArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数A-填写技能卡ID，见技能分组表
</span>            <span class="keyword">local</span> cardLevel = <span class="global">tonumber</span>(effectArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-填写技能卡等级
</span>            <span class="keyword">local</span> triggerCd = <span class="global">tonumber</span>(effectArgs[<span class="number">3</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数C-填写触发CD
</span>            <span class="keyword">local</span> cardUseCd = <span class="global">tonumber</span>(effectArgs[<span class="number">4</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数D-填写释放CD
</span>            self:<span class="function-name">triggerPassiveCard</span>(cardId, cardLevel, triggerCd, cardUseCd, triggerUnit)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="comment">--执行被动技能表逻辑
</span><span class="keyword">local</span> AbilityConfigPassive = {}
<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onCheckDettachDead</span>()
    <span class="keyword">return</span> <span class="keyword">true</span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function-name">initEventMap</span>(self)
    self.effectList = {}
    <span class="keyword">local</span> resPassive = self.resPassive
    <span class="keyword">local</span> skillLevel = self:<span class="function-name">getSkillLevel</span>()
    <span class="keyword">local</span> resLevel = resPassive <span class="keyword">and</span> resPassive[skillLevel]
    <span class="keyword">local</span> resEffects = resLevel <span class="keyword">and</span> resLevel.effects <span class="keyword">or</span> {}
    <span class="keyword">local</span> eventMap = {}
    <span class="keyword">local</span> <span class="keyword">function</span> <span class="function-name">addEvent</span>(name)
        eventMap[name] = AbilityConfigPassive[name]
    <span class="keyword">end</span>
    <span class="keyword">for</span> _, einfo <span class="keyword">in</span> <span class="global">ipairs</span>(resEffects) <span class="keyword">do</span>
        <span class="keyword">local</span> effectId, effectLevel = einfo.effectId, einfo.effectlevel
        <span class="keyword">local</span> resEffectId = ResPassiveEffect[effectId]
        <span class="keyword">local</span> resEffectLevel = resEffectId <span class="keyword">and</span> resEffectId[effectLevel]
        <span class="keyword">if</span> resEffectLevel <span class="keyword">then</span>
            <span class="keyword">local</span> effectData = {resEffectLevel = resEffectLevel}
            <span class="global">table</span>.<span class="function-name">insert</span>(self.effectList, effectData)
            <span class="keyword">local</span> triggerType = resEffectLevel.triggerType
            <span class="keyword">local</span> triggerSubType = resEffectLevel.triggerSubType
            <span class="keyword">if</span> triggerType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- 触发类型1：监控载体生命
</span>                <span class="function-name">addEvent</span>(<span class="string">'onOwnerHpChange'</span>)
            <span class="keyword">elseif</span> triggerType == <span class="number">2</span> <span class="keyword">then</span> <span class="comment">-- 触发类型2：监控载体使用技能
</span>                <span class="function-name">addEvent</span>(<span class="string">'onOwnerUseSkill'</span>)
            <span class="keyword">elseif</span> triggerType == <span class="number">3</span> <span class="keyword">then</span> <span class="comment">-- 触发类型3：监控载体攻击结果
</span>                <span class="keyword">if</span> triggerSubType &lt;= <span class="number">3</span> <span class="keyword">then</span>
                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerAttackDamage'</span>)
                <span class="keyword">elseif</span> triggerSubType &lt;= <span class="number">5</span> <span class="keyword">then</span>
                    <span class="comment">--addEvent('onAttackState')
</span>                <span class="keyword">elseif</span> triggerSubType == <span class="number">6</span> <span class="keyword">then</span>
                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerAttackKill'</span>)
                <span class="keyword">elseif</span> triggerSubType == <span class="number">7</span> <span class="keyword">then</span>
                    <span class="comment">--addEvent('onAttackMana')
</span>                <span class="keyword">elseif</span> triggerSubType &gt; <span class="number">8</span> <span class="keyword">then</span>
                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerAttackControl'</span>)
                <span class="keyword">end</span>
            <span class="keyword">elseif</span> triggerType == <span class="number">4</span> <span class="keyword">then</span> <span class="comment">-- 触发类型4：被动添加时立即触发
</span>                <span class="function-name">addEvent</span>(<span class="string">'onSelfAttach'</span>)
            <span class="keyword">elseif</span> triggerType == <span class="number">5</span> <span class="keyword">then</span> <span class="comment">-- 触发类型5：监控载体受击结果
</span>                <span class="keyword">if</span> triggerSubType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型1-监控受击次数或值
</span>                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerBeHitDamage'</span>)
                <span class="keyword">elseif</span> triggerSubType == <span class="number">2</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型2-监控受击闪避
</span>                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerBeHitMiss'</span>)
                <span class="keyword">elseif</span> triggerSubType == <span class="number">3</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型3-监控自身死亡
</span>                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerBeHitDie'</span>)
                <span class="keyword">elseif</span> triggerSubType == <span class="number">4</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型4-监控受控制情况
</span>                    <span class="keyword">if</span> resEffectLevel.triggerArgs[<span class="number">2</span>] == <span class="number">1</span> <span class="keyword">then</span>
                        <span class="function-name">addEvent</span>(<span class="string">'onOwnerBeHitControl'</span>)
                    <span class="keyword">else</span>
                        <span class="function-name">addEvent</span>(<span class="string">'onOwnerBeHitControlEnd'</span>)
                    <span class="keyword">end</span>
                <span class="keyword">elseif</span> triggerSubType == <span class="number">5</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型5-监控免疫伤害
</span>                    <span class="function-name">addEvent</span>(<span class="string">'onOwnerBeHitImmune'</span>)
                <span class="keyword">elseif</span> triggerSubType == <span class="number">6</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型6-监控被添加状态
</span>                    <span class="comment">--addEvent('onBeHitState')
</span>                <span class="keyword">end</span>
            <span class="keyword">elseif</span> triggerType == <span class="number">6</span> <span class="keyword">then</span> <span class="comment">-- 触发类型6：监控护盾
</span>                    <span class="comment">--◆子类型1-根据护盾存在与否在维持状态
</span>                    <span class="comment">--参数A-类型1表示存在护盾，类型2表示没有护盾
</span>            <span class="keyword">elseif</span> triggerType == <span class="number">7</span> <span class="keyword">then</span> <span class="comment">-- 触发类型7：监控战场死亡
</span>                <span class="function-name">addEvent</span>(<span class="string">'onGlobalKill'</span>)
            <span class="keyword">elseif</span> triggerType == <span class="number">8</span> <span class="keyword">then</span> <span class="comment">-- 触发类型8：监控战斗胜利
</span>                <span class="function-name">addEvent</span>(<span class="string">'onGlobalAced'</span>)
            <span class="keyword">elseif</span> triggerType == <span class="number">9</span> <span class="keyword">then</span> <span class="comment">-- 触发类型9：监控特殊事件
</span>            <span class="keyword">elseif</span> triggerType == <span class="number">10</span> <span class="keyword">then</span> <span class="comment">-- 触发类型10：监控载体使用技能，技能释放完成后触发{触发类型2为技能释放开始时触发}
</span>                <span class="function-name">addEvent</span>(<span class="string">'onOwnerSkillEnd'</span>)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    self:<span class="function-name">registerTriggerTable</span>(eventMap)
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onSelfAttach</span>()
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel
        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">4</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, <span class="keyword">nil</span>) <span class="keyword">then</span> <span class="comment">-- 触发类型4：被动添加时立即触发
</span>            <span class="function-name">raiseEffect</span>(self, effectData, <span class="keyword">nil</span>)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerHpChange</span>(hp, hpPercent)
    <span class="keyword">local</span> ownerUnit = self:<span class="function-name">getOwnerUnit</span>()
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel
        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">1</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, <span class="keyword">nil</span>) <span class="keyword">then</span> <span class="comment">-- 触发类型1：监控载体生命
</span>            <span class="keyword">local</span> triggerSubType = resEffectLevel.triggerSubType
            <span class="keyword">if</span> triggerSubType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型1-根据已损失生命维持状态层数
</span>                <span class="keyword">local</span> arg1 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-损失生命的百分比
</span>                <span class="keyword">local</span> layer = <span class="global">math</span>.<span class="function-name">floor</span>((<span class="number">10000</span> - hpPercent) / arg1)
                <span class="keyword">if</span> layer ~= (effectData.layer <span class="keyword">or</span> <span class="number">0</span>) <span class="keyword">then</span>
                    effectData.layer = layer
                    <span class="function-name">raiseEffect</span>(self, effectData, ownerUnit)
                <span class="keyword">end</span>
            <span class="keyword">elseif</span> triggerSubType == <span class="number">2</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型2-根据生命值条件维持状态
</span>                <span class="keyword">local</span> arg1 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-类型1表示大于，类型2表示小于
</span>                <span class="keyword">local</span> arg2 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-比较的值
</span>                <span class="keyword">local</span> arg3 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">3</span>]) <span class="comment">-- 参数C-类型1表示绝对值，类型2表示万分比
</span>                <span class="keyword">local</span> value = arg3 == <span class="number">1</span> <span class="keyword">and</span> hp <span class="keyword">or</span> hpPercent
                <span class="keyword">local</span> ok = (arg1 == <span class="number">1</span> <span class="keyword">and</span> value &gt;= arg2) <span class="keyword">or</span> (arg1 == <span class="number">2</span> <span class="keyword">and</span> value &lt;= arg2)
                <span class="keyword">local</span> layer = ok <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">or</span> <span class="number">0</span>
                <span class="keyword">if</span> layer ~= (effectData.layer <span class="keyword">or</span> <span class="number">0</span>) <span class="keyword">then</span>
                    effectData.layer = layer
                    <span class="function-name">raiseEffect</span>(self, effectData, ownerUnit)
                <span class="keyword">end</span>
            <span class="keyword">elseif</span> triggerSubType == <span class="number">3</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型3-表示生命改变时触发，条件满足时仅触发1次
</span>                <span class="keyword">if</span> effectData.once <span class="keyword">then</span>
                    <span class="keyword">return</span>
                <span class="keyword">end</span>
                <span class="keyword">local</span> arg1 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-类型1表示大于，类型2表示小于
</span>                <span class="keyword">local</span> arg2 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-比较的值
</span>                <span class="keyword">local</span> arg3 = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">3</span>]) <span class="comment">-- 参数C-类型1表示绝对值，类型2表示万分比
</span>                <span class="keyword">local</span> value = arg3 == <span class="number">1</span> <span class="keyword">and</span> hp <span class="keyword">or</span> hpPercent
                <span class="keyword">local</span> ok = (arg1 == <span class="number">1</span> <span class="keyword">and</span> value &gt;= arg2) <span class="keyword">or</span> (arg1 == <span class="number">2</span> <span class="keyword">and</span> value &lt;= arg2)
                <span class="keyword">if</span> ok <span class="keyword">then</span>
                    effectData.once = <span class="keyword">true</span>
                    <span class="function-name">raiseEffect</span>(self, effectData, ownerUnit)
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function-name">translateCardType</span>(SkillType, skillType)
    <span class="keyword">if</span> skillType == SkillType.PuGong <span class="keyword">then</span> <span class="comment">--普攻
</span>        <span class="keyword">return</span> <span class="number">1</span>
    <span class="keyword">elseif</span> skillType == SkillType.DaZhao <span class="keyword">then</span> <span class="comment">--大招
</span>        <span class="keyword">return</span> -<span class="number">1</span>
    <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="number">0</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerUseSkill</span>(useAbility, useCardId, useCardType, targetUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel
        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">2</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, targetUnit) <span class="keyword">then</span> <span class="comment">-- 触发类型2：监控载体使用技能
</span>            <span class="keyword">local</span> triggerSubType = resEffectLevel.triggerSubType
            <span class="keyword">if</span> triggerSubType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型1-监控指定ID的技能使用次数
</span>                <span class="keyword">local</span> argUseCardId = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-填写技能卡ID，或指定类型{-1代表大招、0代表所有、1代表普攻}
</span>                <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-次数
</span>                <span class="keyword">if</span> argUseCardId == <span class="number">0</span> <span class="keyword">or</span> argUseCardId == <span class="function-name">translateCardType</span>(self.Enum.SkillType, useCardType) <span class="keyword">or</span> argUseCardId == useCardId <span class="keyword">then</span>
                    <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                        <span class="function-name">raiseEffect</span>(self, effectData, targetUnit)
                    <span class="keyword">end</span>
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerSkillEnd</span>(useAbility, useCardId, useCardType, targetUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel
        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">10</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, targetUnit) <span class="keyword">then</span> <span class="comment">-- 触发类型10：监控载体使用技能，技能释放完成后触发{触发类型2为技能释放开始时触发}
</span>            <span class="keyword">local</span> triggerSubType = resEffectLevel.triggerSubType
            <span class="keyword">if</span> triggerSubType == <span class="number">1</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型1-监控指定ID的技能使用次数
</span>                <span class="keyword">local</span> argUseCardId = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-填写技能卡ID，或指定类型{-1代表大招、0代表所有、1代表普攻}
</span>                <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-次数
</span>                <span class="keyword">if</span> argUseCardId == <span class="number">0</span> <span class="keyword">or</span> argUseCardId == <span class="function-name">translateCardType</span>(useCardType) <span class="keyword">or</span> argUseCardId == useCardId <span class="keyword">then</span>
                    <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                        <span class="function-name">raiseEffect</span>(self, effectData, targetUnit)
                    <span class="keyword">end</span>
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerAttackDamage</span>(targetUnit, damage, damageType, isCrit, skillType)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型3：监控载体攻击结果
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">3</span> <span class="keyword">and</span> resEffectLevel.triggerSubType &lt;= <span class="number">3</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, targetUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> triggerSubType = resEffectLevel.triggerSubType
            <span class="keyword">local</span> triggerArgs = resEffectLevel.triggerArgs
            <span class="keyword">local</span> argRecordType = <span class="global">tonumber</span>(triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-类型1表示监控攻击次数，类型2表示监控攻击值
</span>            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(triggerArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-次数或值
</span>            <span class="keyword">local</span> critOnly = <span class="global">tonumber</span>(triggerArgs[<span class="number">3</span>]) <span class="comment">-- 参数C-监控暴击类型，类型0表示所有伤害，类型1表示暴击伤害，类型2表示爆头伤害(默认0)
</span>            <span class="keyword">local</span> typeFilter = <span class="global">tonumber</span>(triggerArgs[<span class="number">4</span>]) <span class="comment">-- 参数D-监控攻击类型，类型0表示伤害，类型1表示治疗，类型2表示掉血，类型3表示普攻伤害，类型4表示大招伤害，类型5表示护盾(默认0)
</span>            <span class="keyword">local</span> wantType = (typeFilter == <span class="number">0</span> <span class="keyword">and</span> <span class="string">'hurtHp'</span>) <span class="keyword">or</span> (typeFilter == <span class="number">1</span> <span class="keyword">and</span> <span class="string">'healHp'</span>)
            <span class="keyword">local</span> wantSkill = (typeFilter == <span class="number">4</span> <span class="keyword">and</span> <span class="number">1</span>) <span class="keyword">or</span> (typeFilter == <span class="number">3</span> <span class="keyword">and</span> <span class="number">0</span>)
            <span class="keyword">if</span> (<span class="keyword">not</span> wantType <span class="keyword">or</span> wantType == damageType) <span class="keyword">and</span> (<span class="keyword">not</span> wantSkill <span class="keyword">or</span> wantSkill == skillType) <span class="keyword">and</span> (critOnly == <span class="number">0</span> <span class="keyword">or</span> isCrit) <span class="keyword">then</span>
                <span class="comment">-- ◆子类型1-监控攻击次数或值，对所有目标的攻击结果累加
</span>                <span class="keyword">local</span> countId = triggerSubType == <span class="number">2</span> <span class="keyword">and</span> targetUnit <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- ◆子类型2-监控攻击次数或值，对所有目标的攻击结果分别计算和触发
</span>                <span class="keyword">local</span> addValue = argRecordType == <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">or</span> damage
                <span class="keyword">if</span> triggerSubType == <span class="number">3</span> <span class="keyword">then</span> <span class="comment">-- ◆子类型3-监控攻击次数或值，切换目标时次数或值重新累积，特殊用途
</span>                    <span class="keyword">if</span> effectData.targetUnit ~= targetUnit <span class="keyword">then</span>
                        effectData.targetUnit = targetUnit
                        self:<span class="function-name">clearCount</span>(<span class="number">1</span>)
                    <span class="keyword">end</span>
                <span class="keyword">end</span>
                <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(countId, addValue, argNeedCount) <span class="keyword">then</span>
                    <span class="function-name">raiseEffect</span>(self, effectData, targetUnit)
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerAttackKill</span>(targetUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型3：监控载体攻击结果 ◆子类型6-监控造成击杀
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">3</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">6</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, targetUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-次数
</span>            <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, targetUnit)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerAttackControl</span>(targetUnit, controlType)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型3：监控载体攻击结果 ◆子类型8-监控造成控制
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">3</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">8</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, targetUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argControlType = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-类型stun表示眩晕，类型freeze表示冰冻，类型Float表示击飞，类型timelock表示锁定，其它表示任意控制
</span>            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数B-填写次数
</span>            <span class="keyword">if</span> argControlType == <span class="keyword">nil</span> <span class="keyword">or</span> controlType == argControlType <span class="keyword">then</span>
                <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                    <span class="function-name">raiseEffect</span>(self, effectData, targetUnit)
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerBeHitDamage</span>(attackerUnit, damage, damageType, crit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型5：监控载体受击结果 ◆子类型1-监控受击次数或值
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">5</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">1</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, attackerUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> triggerSubType = resEffectLevel.triggerSubType
            <span class="keyword">local</span> triggerArgs = resEffectLevel.triggerArgs
            <span class="keyword">local</span> argRecordType = <span class="global">tonumber</span>(triggerArgs[<span class="number">1</span>]) <span class="comment">-- 参数A-类型1表示监控攻击次数，类型2表示监控攻击值
</span>            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(triggerArgs[<span class="number">2</span>]) <span class="comment">-- 参数B-次数或值
</span>            <span class="keyword">local</span> critOnly = <span class="global">tonumber</span>(triggerArgs[<span class="number">3</span>]) <span class="comment">-- 参数C-监控暴击类型，类型0表示所有伤害，类型1表示暴击伤害，类型2表示爆头伤害(默认0)
</span>            <span class="keyword">local</span> typeFilter = <span class="global">tonumber</span>(triggerArgs[<span class="number">4</span>]) <span class="comment">-- 参数D-监控攻击类型，类型0表示伤害，类型1表示治疗，类型2表示掉血，类型3表示普攻伤害，类型4表示大招伤害，类型5表示护盾(默认0)
</span>            <span class="keyword">local</span> selfFilter = <span class="global">tonumber</span>(triggerArgs[<span class="number">5</span>]) <span class="comment">-- 参数E-监控伤害来源，类型0表示全部，类型1表示自身，类型2表示别人
</span>            <span class="keyword">local</span> ownerUnit = self:<span class="function-name">getOwnerUnit</span>()
            <span class="keyword">if</span> typeFilter == damageType <span class="keyword">and</span> (critOnly == <span class="number">0</span> <span class="keyword">or</span> crit) <span class="keyword">and</span> (selfFilter == <span class="number">0</span> <span class="keyword">or</span> (selfFilter == <span class="number">1</span>) == (attackerUnit == ownerUnit)) <span class="keyword">then</span>
                <span class="keyword">local</span> addValue = argRecordType == <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">or</span> damage
                <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, addValue, argNeedCount) <span class="keyword">then</span>
                    <span class="function-name">raiseEffect</span>(self, effectData, attackerUnit)
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerBeHitMiss</span>(attackerUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型5：监控载体受击结果 ◆子类型2-监控受击闪避
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">5</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">2</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, attackerUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-填写次数
</span>            <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, attackerUnit)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerBeHitDie</span>(attackerUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型5：监控载体受击结果 ◆子类型3-监控自身死亡
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">5</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">3</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, attackerUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-填写次数
</span>            <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, attackerUnit)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerBeHitControl</span>(attackerUnit, controlType)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型5：监控载体受击结果 ◆子类型4-监控受控制情况 参数B-类型0表示控制效果移除时触发，类型1表示控制效果添加时触发
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">5</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">4</span> <span class="keyword">and</span> resEffectLevel.triggerArgs[<span class="number">2</span>] == <span class="number">1</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, attackerUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-填写次数
</span>            <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, attackerUnit)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerBeHitControlEnd</span>(controlType)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型5：监控载体受击结果 ◆子类型4-监控受控制情况 参数B-类型0表示控制效果移除时触发，类型1表示控制效果添加时触发
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">5</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">4</span> <span class="keyword">and</span> resEffectLevel.triggerArgs[<span class="number">2</span>] ~= <span class="number">0</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, <span class="keyword">nil</span>) <span class="keyword">then</span>
            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-填写次数
</span>            <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, <span class="keyword">nil</span>)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onOwnerBeHitImmune</span>(attackerUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型5：监控载体受击结果 ◆子类型5-监控免疫伤害
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">5</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">5</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, attackerUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数A-填写次数
</span>            <span class="keyword">if</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, attackerUnit)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onGlobalKill</span>(attackerUnit, targetUnit)
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型7：监控战场死亡
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">7</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">1</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, targetUnit) <span class="keyword">then</span>
            <span class="keyword">local</span> argRecordType = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">1</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数A-类型1表示监控敌人，类型2表示监控己方
</span>            <span class="keyword">local</span> argNeedCount = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="keyword">or</span> <span class="number">1</span> <span class="comment">-- 参数B-数量
</span>            <span class="keyword">local</span> argObjFilter = <span class="global">tonumber</span>(resEffectLevel.triggerArgs[<span class="number">2</span>]) <span class="keyword">or</span> <span class="number">0</span> <span class="comment">-- 参数C-类型0表示监控任意单位，类型1表示监控英雄死亡，类型2表示监控召唤物死亡
</span>            <span class="keyword">local</span> ownerUnit = self:<span class="function-name">getOwnerUnit</span>()
            <span class="keyword">local</span> campOk = (argRecordType == <span class="number">1</span> <span class="keyword">and</span> ownerUnit:<span class="function-name">isEnemy</span>(targetUnit)) <span class="keyword">or</span> (argRecordType == <span class="number">2</span> <span class="keyword">and</span> ownerUnit:<span class="function-name">isFriend</span>(targetUnit)) <span class="keyword">or</span> argRecordType == <span class="number">3</span>
            <span class="keyword">local</span> typeOk = argObjFilter == <span class="number">0</span> <span class="keyword">or</span> (argObjFilter == <span class="number">1</span> <span class="keyword">and</span> targetUnit:<span class="function-name">isHero</span>()) <span class="keyword">or</span> (argObjFilter == <span class="number">2</span> <span class="keyword">and</span> targetUnit:<span class="function-name">isMinor</span>())
            <span class="keyword">if</span> campOk <span class="keyword">and</span> typeOk <span class="keyword">and</span> self:<span class="function-name">addCountUntil</span>(<span class="number">1</span>, <span class="number">1</span>, argNeedCount) <span class="keyword">then</span>
                <span class="function-name">raiseEffect</span>(self, effectData, targetUnit)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="keyword">function</span> AbilityConfigPassive:<span class="function-name">onGlobalAced</span>(deadUnit)
    <span class="keyword">local</span> ownerUnit = self:<span class="function-name">getOwnerUnit</span>()
    <span class="keyword">if</span> deadUnit <span class="keyword">and</span> deadUnit:<span class="function-name">isFriend</span>(ownerUnit) <span class="keyword">then</span>
        <span class="keyword">return</span>
    <span class="keyword">end</span>
    <span class="keyword">for</span> _, effectData <span class="keyword">in</span> <span class="global">ipairs</span>(self.effectList) <span class="keyword">do</span>
        <span class="keyword">local</span> resEffectLevel = effectData.resEffectLevel <span class="comment">-- 触发类型8：监控战斗胜利
</span>        <span class="keyword">if</span> resEffectLevel.triggerType == <span class="number">8</span> <span class="keyword">and</span> resEffectLevel.triggerSubType == <span class="number">1</span> <span class="keyword">and</span> self:<span class="function-name">checkCondition</span>(self, resEffectLevel, <span class="keyword">nil</span>) <span class="keyword">then</span>
            <span class="function-name">raiseEffect</span>(self, effectData, <span class="keyword">nil</span>)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function-name">newAbilityConfigPassive</span>(passiveId)
    <span class="keyword">return</span> <span class="keyword">function</span> (ability)
        ability.passiveId = passiveId
        ability.resPassive = ResPassiveSkill[passiveId]
        <span class="function-name">initEventMap</span>(ability)
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">return</span> newAbilityConfigPassive</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/lunarmodules/LDoc">LDoc 1.5.0</a></i>
<i style="float:right;">Last updated 2025-09-26 15:17:20 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
